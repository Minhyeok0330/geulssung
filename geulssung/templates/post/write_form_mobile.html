<!-- write_form_mobile.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>글쓰기 ✍️ (모바일)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap');
    body { font-family: 'Gowun Batang', serif; }
    summary { font-weight: bold; cursor: pointer; }
  </style>
</head>
<body class="bg-[#bae6fd] min-h-screen text-[#493E3E]">
  {% include "nav_bar.html" %}
  <div class="p-4 space-y-6">
    <form method="post" action="" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="character" id="character-input" value="none">
      <input type="hidden" name="custom_prompt" id="customPromptHidden">

      <!-- 1. 도우미 선택 -->
      <div>
        <p class="font-semibold mb-2">오늘의 글쓰기 도우미를 선택해보세요!</p>
        <div class="flex gap-3">
          <label class="flex items-center gap-2">
            <input type="radio" name="category" value="emotion" onchange="handleCharacterSelection(this.value)">
            글썽이
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="category" value="logic" onchange="handleCharacterSelection(this.value)">
            말썽이
          </label>
        </div>
      </div>

      <!-- 2. 형식 선택 -->
      <div id="genre-emotion" class="hidden">
        <p class="font-semibold mt-4 mb-2">형식을 골라보세요 (글썽이)</p>
        <div class="flex gap-3">
          <label><input type="radio" name="genre" value="essay" onchange="showGuide(this.value)"> 에세이</label>
          <label><input type="radio" name="genre" value="poem" onchange="showGuide(this.value)"> 시</label>
        </div>
      </div>
      <div id="genre-logic" class="hidden">
        <p class="font-semibold mt-4 mb-2">형식을 골라보세요 (말썽이)</p>
        <div class="flex gap-3">
          <label><input type="radio" name="genre" value="column" onchange="showGuide(this.value)"> 칼럼</label>
          <label><input type="radio" name="genre" value="analysis" onchange="showGuide(this.value)"> 분석글</label>
        </div>
      </div>

      <!-- 3. 글감 선택 -->
      <div id="prompt-box" class="mt-4 hidden">
        <p class="font-semibold mb-1">📖 오늘의 글감을 골라보세요</p>
        <div class="flex gap-2 text-sm">
          <button type="button" id="refreshPromptsBtn" class="px-2 py-1 bg-blue-100 rounded">🔄 새로운 글감</button>
          <button type="button" id="customPromptBtn" class="px-2 py-1 bg-yellow-100 rounded">✏️ 직접 입력</button>
        </div>
        <div id="prompt-options" class="mt-2 space-y-2"></div>
        <div id="customPromptInputBox" class="mt-2 hidden">
          <input type="text" id="customPromptInput" class="w-full border px-2 py-1 rounded" placeholder="글감을 입력해주세요" />
          <button type="button" id="customPromptSelectBtn" class="mt-1 bg-blue-100 px-2 py-1 rounded">선택</button>
        </div>
        <input type="hidden" name="topic" id="selectedPrompt">
        <input type="hidden" name="prompt_id" id="selectedPromptId">
      </div>

      <!-- 4. 글쓰기 가이드 (접고 펴기) -->
      <div id="guide-scrollable" class="bg-white p-4 rounded-lg shadow">
        <details class="guide-toggle">
          <summary>💧 한 방울</summary>
          <div id="guide-template-step1"></div>
        </details>
        <details class="guide-toggle">
          <summary>💧💧 두 방울</summary>
          <div id="guide-template-step2"></div>
        </details>
        <details class="guide-toggle">
          <summary>💧💧💧 세 방울</summary>
          <div id="guide-template-step3"></div>
        </details>
      </div>

      <!-- 5. 글쓰기 입력 영역 -->
      <div class="mt-6">
        <label class="block mb-1 font-semibold">제목</label>
        <input type="text" name="title" class="w-full border px-3 py-2 rounded-md" required />
      </div>

      <div class="mt-6">
        <label class="block mb-1 font-semibold">🧩 글줄기</label>
        <textarea name="final_text" rows="8" class="w-full border px-3 py-2 rounded-md" required></textarea>
      </div>

      <div class="mt-6 text-right">
        <button type="submit" class="bg-[#bae6fd] hover:bg-[#7dd3fc] px-6 py-2 rounded-full font-bold text-[#493E3E]">보관하기</button>
      </div>
    </form>
  </div>

  <!-- 챗봇 토글 버튼 + 챗봇 (모바일용 고정) -->
  <button id="chat-toggle-btn" type="button"
    class="fixed bottom-4 right-4 z-50 bg-[#bae6fd] text-[#493E3E] px-4 py-2 rounded-full shadow-lg text-sm">
    도와줘
  </button>
  <div id="chat-box" class="hidden fixed bottom-16 right-4 z-50 w-80 bg-white rounded-lg shadow-lg p-4">
    <div id="chat-log" class="h-40 overflow-y-auto text-sm mb-2"></div>
    <textarea id="chat-input" class="w-full border rounded p-2 text-sm" rows="2" placeholder="도움을 받아보세요!"></textarea>
    <button id="chat-send-btn" class="mt-2 w-full bg-blue-100 text-[#493E3E] font-bold px-4 py-2 rounded">전송</button>
  </div>

  <script src="{% static 'js/write_form_common.js' %}"></script>
  <script>
    document.getElementById("chat-toggle-btn").onclick = () => {
      document.getElementById("chat-box").classList.toggle("hidden");
    };
  </script>
</body>
</html>
